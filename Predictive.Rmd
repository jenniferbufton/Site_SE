---
title: Predictive Modelling
output: 
  html_document:
    toc: true
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: flatly
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(caret)
library(dplyr)
library(readxl)
library(rpart)
library(rpart.plot)

setwd("C:/Users/jenniferb/OneDrive - Sport England/GitHub/Small Grants")
me_df <- read_xlsx('MandE.xlsx', na = "NA")

data <- me_df%>%
  select(AWARD, Total_Project_Cost, Partnership_Funding, GOVERNMENT_OFFICE_REGION, Focus,
         ALLOCATED_TO, IMD_DECILE, `12 MONTH PARTICIPANTS`, Org_Class)

data <- as.data.frame(data)

#set.seed(123)
inTrain <- createDataPartition(y=data$`12 MONTH PARTICIPANTS`, p=1, list=FALSE) 
Train <- data[inTrain,]
#Test <- data[-inTrain,]

```

# Decision Trees

The ‘tree’ is a sequence of decisions (branches) that aim to maximise the reduction in the variation in the outcome variable (in this case, the number of participants at 12 months).



<br>

# Outputs  {.tabset .tabset-fade .tabset-pills} 
The model below shows the first "branch", i.e. the most important variable out of those included that explain variation.  This is the "Total Project Cost" - if the total cost is greater than or equal to £23,707.93 (4% of the awards), the mean number of participants is 611 . Less than this amount, and the mean number is 176, and this accounts for 96% of the awards.

The model was limited to the most important variable (branch 1). The more depth we go down, the better the model will 'fit' our data. This can be problematic if we tried to predict an outcome based on this model. The data may become 'over-fitted' (i.e. the model is only acccurate when applied to this specific dataset).

## Decision Tree Plot
```{r tree.1, echo=FALSE, fig.align="center", message=FALSE, warning=FALSE}
tree <- rpart(`12 MONTH PARTICIPANTS` ~., data=Train, maxdepth = 1)
rpart.plot(tree, tweak = 1.5, cex = 0.5, type = 1)
```

## Decision Tree Summary
```{r tree.2, echo=FALSE, fig.align="center", message=FALSE, warning=FALSE}
tree
```


## Variable Importance
```{r tree.3, echo=FALSE, fig.align="center", message=FALSE, warning=FALSE}
tree$variable.importance
```

